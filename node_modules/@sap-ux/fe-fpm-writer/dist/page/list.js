"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generate = void 0;
const path_1 = require("path");
const mem_fs_1 = require("mem-fs");
const mem_fs_editor_1 = require("mem-fs-editor");
const ejs_1 = require("ejs");
const common_1 = require("./common");
const templates_1 = require("../templates");
/**
 * Enhances the provided list report configuration with default data.
 *
 * @param data - a list report configuration object
 * @param manifest - application manifest
 * @returns enhanced configuration
 */
function enhanceData(data, manifest) {
    var _a, _b;
    const config = Object.assign(Object.assign(Object.assign({ settings: {} }, data), { name: 'ListReport' }), common_1.getFclConfig(manifest));
    // move settings into correct possition in the manifest
    config.settings.entitySet = data.entity;
    config.settings.navigation = {};
    // use standard file name if i18n enhancement required
    if (config.settings.enhanceI18n === true) {
        config.settings.enhanceI18n = `i18n/custom${config.entity}${config.name}.properties`;
    }
    // move table settings into the correct structure
    if (config.settings.tableSettings) {
        config.settings.controlConfiguration = (_a = config.settings.controlConfiguration) !== null && _a !== void 0 ? _a : {};
        config.settings.controlConfiguration['@com.sap.vocabularies.UI.v1.LineItem'] =
            (_b = config.settings.controlConfiguration['@com.sap.vocabularies.UI.v1.LineItem']) !== null && _b !== void 0 ? _b : {};
        config.settings.controlConfiguration['@com.sap.vocabularies.UI.v1.LineItem'].tableSettings =
            config.settings.tableSettings;
        delete config.settings.tableSettings;
    }
    return config;
}
/**
 * Add a ListReport to an existing UI5 application.
 *
 * @param basePath - the base path
 * @param data - the object page configuration
 * @param fs - the memfs editor instance
 * @returns the updated memfs editor instance
 */
function generate(basePath, data, fs) {
    if (!fs) {
        fs = mem_fs_editor_1.create(mem_fs_1.create());
    }
    common_1.validatePageConfig(basePath, data, fs);
    const manifestPath = path_1.join(basePath, 'webapp/manifest.json');
    const manifest = fs.readJSON(manifestPath);
    const config = enhanceData(data, manifest);
    // enhance manifest.json
    fs.extendJSON(manifestPath, JSON.parse(ejs_1.render(fs.read(templates_1.getTemplatePath('page/list/manifest.json')), config, {})), common_1.getManifestJsonExtensionHelper(config));
    return fs;
}
exports.generate = generate;
//# sourceMappingURL=list.js.map